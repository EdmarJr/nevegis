<html>
<head>
	<title>Exemplo - com JQuery e JQueryUI</title>
	<link href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" type="text/css" rel="stylesheet"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
	<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js" type="text/javascript"></script>
	<script src="http://malsup.github.io/jquery.blockUI.js" type="text/javascript"></script>
	<script src="ICPBravoAPIMini-1.33.js" type="text/javascript"></script>
	<script type="text/javascript">

		$(function() {
			$("#assinarButton").click(onAssinarButtonClick);
		});

		function onAppletLoaded() {
			icpBravoApplet.setFilterICPBrasil(true);
			icpBravoApplet.loadCertificatesAsync(
				null,                        // managerName
				"certificateSelect",         // selectId
				null,                        // onSuccess
				null,                        // onError
				"Carregando certificados..." // msg
			);
		}
		
		function onAssinarButtonClick() {
	        var selectedCertIndex = $("#certificateSelect").val();	       	       	
	        icpBravoApplet.getCertificatePropertiesAsync(
				selectedCertIndex,               // certIndex
				onCertificateLoaded,             // onSuccess
				null,                            // onError
				"Lendo certificado, aguarde..."  // msg
			); 
		}
		
		function onCertificateLoaded(cert) {
			
			alert("Certificate:\r\n" + cert);	

			// normalmente, o valor de "cert" seria enviado via Ajax para o servidor para calcular o "toSign"
			var toSign = "SGVsbG8sIFdvcmxkIQ==";
	
	        var selectedCertIndex = $("#certificateSelect").val();	       	       	
			icpBravoApplet.signSimpleBytesAsync(
				selectedCertIndex,       // certIndex
				toSign,                  // toSign
				onSignCompleted,         // onSuccess
				null,                    // onError
				"Aguarde, assinando..."  // msg
			); 
		}
		
		function onSignCompleted(signature) {
			alert("Signature:\r\n" + signature);
		}
	</script>
</head>
<body>
<select id='certificateSelect'></select>
<input type="button" value="Assinar" id="assinarButton" />
<script type="text/javascript">
	icpBravoApplet.start({
		appletUrl: 'ICPBravoAPIMini-1.33.jar',
		onLoad: onAppletLoaded,
		message: 'Aguarde, carregando applet...'
	});
</script>
</body>
</html>